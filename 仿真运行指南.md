# Activity Tracker 仿真运行指南

## 📱 快速启动

### 方法1：自动化脚本（推荐）

```bash
# 在项目根目录执行
cd /Users/shanwanjun/Desktop/cxs/time/time
./run-simulation.sh
```

### 方法2：手动命令行操作

#### 🖥️ Mac应用仿真

```bash
# 1. 进入Xcode项目目录
cd /Users/shanwanjun/Desktop/cxs/time/time

# 2. 清理并编译Mac版本
xcodebuild clean build \
  -project time.xcodeproj \
  -scheme time \
  -destination 'platform=macOS'

# 3. 启动Mac应用
open /Users/shanwanjun/Library/Developer/Xcode/DerivedData/time-*/Build/Products/Debug/TIME.app
```

#### 📱 iPhone应用仿真

```bash
# 1. 进入Xcode项目目录
cd /Users/shanwanjun/Desktop/cxs/time/time

# 2. 启动模拟器（如果未运行）
open -a Simulator

# 3. 等待模拟器启动（约3-5秒）
sleep 5

# 4. 查看可用的模拟器设备
xcrun simctl list devices | grep iPhone

# 5. 清理并编译iPhone版本
xcodebuild clean build \
  -project time.xcodeproj \
  -scheme time \
  -destination 'platform=iOS Simulator,name=iPhone 17'

# 6. 安装到模拟器
xcrun simctl install booted \
  /Users/shanwanjun/Library/Developer/Xcode/DerivedData/time-*/Build/Products/Debug-iphonesimulator/TIME.app

# 7. 启动应用
xcrun simctl launch booted com.cxs.time
```

### 方法3：使用Xcode GUI

#### Mac应用

1. 打开Xcode
   ```bash
   open /Users/shanwanjun/Desktop/cxs/time/time/time.xcodeproj
   ```

2. 在Xcode顶部工具栏：
   - 选择 Scheme: `time`
   - 选择 Destination: `My Mac`

3. 点击 ▶️ 运行按钮（或按 `Cmd + R`）

#### iPhone应用

1. 打开Xcode
   ```bash
   open /Users/shanwanjun/Desktop/cxs/time/time/time.xcodeproj
   ```

2. 在Xcode顶部工具栏：
   - 选择 Scheme: `time`
   - 选择 Destination: `iPhone 17` (或其他iPhone模拟器)

3. 点击 ▶️ 运行按钮（或按 `Cmd + R`）

---

## 🔧 常见问题排查

### 问题1：找不到DerivedData目录

**解决方案：**
```bash
# 查找实际的DerivedData路径
find ~/Library/Developer/Xcode/DerivedData -name "TIME.app" -type d 2>/dev/null
```

### 问题2：模拟器无法启动应用

**解决方案：**
```bash
# 1. 终止现有应用进程
xcrun simctl terminate booted com.cxs.time

# 2. 卸载应用
xcrun simctl uninstall booted com.cxs.time

# 3. 重新安装
xcrun simctl install booted [应用路径]

# 4. 重新启动
xcrun simctl launch booted com.cxs.time
```

### 问题3：编译失败

**解决方案：**
```bash
# 1. 清理所有构建产物
xcodebuild clean -project time.xcodeproj -scheme time

# 2. 清理DerivedData
rm -rf ~/Library/Developer/Xcode/DerivedData/time-*

# 3. 重新编译
xcodebuild build -project time.xcodeproj -scheme time -destination 'platform=macOS'
```

### 问题4：模拟器设备列表为空

**解决方案：**
```bash
# 1. 查看所有可用设备
xcrun simctl list devices available

# 2. 如果没有设备，创建新设备
xcrun simctl create "iPhone 17" "iPhone 17"

# 3. 启动设备
xcrun simctl boot "iPhone 17"
```

---

## 📊 验证清单

### Mac应用验证

- [ ] 应用成功启动
- [ ] 界面正常显示
- [ ] 导航栏功能正常
- [ ] 数据正确加载（12个项目）
- [ ] 暂停按钮功能正常

### iPhone应用验证

- [ ] 应用成功启动
- [ ] 界面正常显示
- [ ] 导航栏不超出系统状态栏
- [ ] 数据正确加载（12个项目）
- [ ] 暂停按钮功能正常
- [ ] 卡片滑动不超出状态栏
- [ ] 底部内容不被Home Indicator遮挡

---

## 🎯 功能测试步骤

### 1. 暂停按钮测试

1. 点击「记录」页面
2. 输入活动内容（如："测试暂停功能"）
3. 选择分类和项目
4. 点击「开始记录」
5. 等待计时器运行几秒
6. 点击「⏸️ 暂停」按钮
   - ✅ 确认计时器停止
   - ✅ 确认按钮变为「▶️ 继续」
   - ✅ 确认显示通知「活动已暂停」
7. 点击「▶️ 继续」按钮
   - ✅ 确认计时器继续
   - ✅ 确认按钮变为「⏸️ 暂停」
   - ✅ 确认显示通知「活动已继续」

### 2. 项目选择器测试

1. 点击「记录」页面
2. 查看「关联项目」下拉选择器
   - ✅ 确认显示「自动关联」选项
   - ✅ 确认显示12个进行中的项目
   - ✅ 项目名称正确显示

### 3. iOS安全区域测试（仅iPhone）

1. 打开应用
2. 滑动浏览各个页面
   - ✅ 导航栏始终在系统状态栏下方
   - ✅ 项目卡片不会显示在状态栏上
   - ✅ 底部内容不被Home Indicator遮挡
3. 旋转设备到横屏模式
   - ✅ 左右边缘有适当间距
   - ✅ 内容不被刘海/灵动岛遮挡

---

## 🚀 性能优化建议

### 编译速度优化

```bash
# 使用并行编译
xcodebuild -jobs 8 build -project time.xcodeproj -scheme time

# 只编译必要的架构
xcodebuild build -project time.xcodeproj -scheme time \
  -destination 'platform=macOS' \
  ONLY_ACTIVE_ARCH=YES
```

### 模拟器性能优化

```bash
# 关闭不必要的模拟器
xcrun simctl shutdown all

# 只启动需要的模拟器
xcrun simctl boot "iPhone 17"
```

---

## 📝 日志查看

### Mac应用日志

```bash
# 实时查看Console日志
log stream --predicate 'processImagePath contains "TIME"' --level debug
```

### iPhone模拟器日志

```bash
# 查看模拟器日志
xcrun simctl spawn booted log stream --predicate 'processImagePath contains "TIME"'

# 或使用Console.app
open -a Console
# 然后在左侧选择对应的模拟器设备
```

---

## 🔄 快速重启

### Mac应用

```bash
# 关闭应用
killall TIME

# 重新启动
open /Users/shanwanjun/Library/Developer/Xcode/DerivedData/time-*/Build/Products/Debug/TIME.app
```

### iPhone应用

```bash
# 终止应用
xcrun simctl terminate booted com.cxs.time

# 重新启动
xcrun simctl launch booted com.cxs.time
```

---

## 📞 技术支持

如遇到问题，请检查：
1. Xcode版本是否为最新
2. macOS系统版本是否兼容
3. 项目路径是否正确
4. 网络连接是否正常（如需下载依赖）

---

**最后更新：** 2025年10月25日  
**版本：** v2.2.0  
**状态：** ✅ 已验证

