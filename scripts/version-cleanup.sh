#!/bin/bash
# ç‰ˆæœ¬æ¸…ç†è„šæœ¬ - é‡ç½®ç‰ˆæœ¬å·åˆ°åˆç†èŒƒå›´

echo "ğŸ§¹ ç‰ˆæœ¬æ¸…ç†å¼€å§‹..."
echo "================================="

# è·å–å½“å‰ç‰ˆæœ¬
current_version=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
echo "å½“å‰ç‰ˆæœ¬: $current_version"

# è®¡ç®—åˆç†çš„ç‰ˆæœ¬å·
# åŸºäºé¡¹ç›®å®é™…å¼€å‘è¿›åº¦ï¼Œå»ºè®®è®¾ç½®ä¸º v1.5.0
target_version="v1.5.0"

echo "ç›®æ ‡ç‰ˆæœ¬: $target_version"

# åˆ›å»ºæ–°çš„ç‰ˆæœ¬æ ‡ç­¾
echo "ğŸ·ï¸ åˆ›å»ºæ–°ç‰ˆæœ¬æ ‡ç­¾: $target_version"
git tag -a $target_version -m "ç‰ˆæœ¬æ¸…ç†: é‡ç½®åˆ°åˆç†ç‰ˆæœ¬å· $target_version"

# åˆ é™¤è¿‡é«˜çš„ç‰ˆæœ¬æ ‡ç­¾ï¼ˆå¯é€‰ï¼Œè°¨æ…æ“ä½œï¼‰
echo "âš ï¸ æ³¨æ„: ä»¥ä¸‹ç‰ˆæœ¬æ ‡ç­¾å°†è¢«åˆ é™¤ï¼ˆä»…æœ¬åœ°ï¼‰:"
git tag --sort=-version:refname | grep -E "v1\.(1[0-9][0-9]|[2-9][0-9]|[0-9]{3,})" | head -10

read -p "æ˜¯å¦åˆ é™¤è¿‡é«˜çš„ç‰ˆæœ¬æ ‡ç­¾ï¼Ÿ(y/N): " confirm
if [[ $confirm == [yY] ]]; then
    echo "ğŸ—‘ï¸ åˆ é™¤è¿‡é«˜çš„ç‰ˆæœ¬æ ‡ç­¾..."
    git tag --sort=-version:refname | grep -E "v1\.(1[0-9][0-9]|[2-9][0-9]|[0-9]{3,})" | xargs -I {} git tag -d {}
    echo "âœ… ç‰ˆæœ¬æ ‡ç­¾æ¸…ç†å®Œæˆ"
else
    echo "â„¹ï¸ è·³è¿‡ç‰ˆæœ¬æ ‡ç­¾åˆ é™¤"
fi

echo "ğŸ“Š ç‰ˆæœ¬ç»Ÿè®¡:"
echo "æ€»æ ‡ç­¾æ•°: $(git tag | wc -l)"
echo "æœ€æ–°ç‰ˆæœ¬: $(git describe --tags --abbrev=0)"

echo "âœ… ç‰ˆæœ¬æ¸…ç†å®Œæˆï¼"
echo "ğŸ’¡ å»ºè®®: ä»Šååªåœ¨é‡è¦é‡Œç¨‹ç¢‘æ—¶æ‰‹åŠ¨åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾"
