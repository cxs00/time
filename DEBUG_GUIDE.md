# 🔧 TIME App 调试指南

## 📱 iOS模拟器 + 💻 Mac 双平台调试

---

## 🚀 快速开始

### 方法1：Xcode自动打开（已执行）

Xcode项目已自动打开！

**接下来在Xcode中操作：**

#### 第一步：选择iOS模拟器
1. 在Xcode顶部工具栏，找到设备选择器
2. 点击当前设备名称（靠近"TIME"旁边）
3. 选择iOS模拟器：
   ```
   推荐选择：
   ├─ iPhone 15 Pro        （最新标准机型）
   ├─ iPhone 15 Pro Max    （大屏测试）
   ├─ iPhone SE (3rd gen)  （小屏测试）
   └─ iPad Pro 12.9"       （平板测试）
   ```

#### 第二步：运行iOS版本
1. 点击左上角的 **"运行"** 按钮（▶️）
2. 或按快捷键：`Cmd + R`
3. 等待编译和启动（首次可能需要1-2分钟）
4. 模拟器会自动启动并运行TIME应用

#### 第三步：选择Mac运行
1. 在设备选择器中选择 **"My Mac"** 或 **"My Mac (Designed for iPad)"**
2. 点击运行按钮或按 `Cmd + R`
3. TIME应用会在Mac上作为原生应用运行

---

## 📱 iOS模拟器调试

### 推荐的测试设备组合

#### 小屏幕测试
```
iPhone SE (3rd generation)
- 屏幕尺寸：4.7英寸
- 分辨率：750 x 1334
- 测试重点：布局是否紧凑合理
```

#### 标准屏幕测试
```
iPhone 15 Pro
- 屏幕尺寸：6.1英寸
- 分辨率：1179 x 2556
- 测试重点：主要用户体验
```

#### 大屏幕测试
```
iPhone 15 Pro Max
- 屏幕尺寸：6.7英寸
- 分辨率：1290 x 2796
- 测试重点：空间利用是否合理
```

#### 平板测试
```
iPad Pro 12.9"
- 屏幕尺寸：12.9英寸
- 分辨率：2048 x 2732
- 测试重点：横竖屏布局
```

### 模拟器调试技巧

#### 快捷键
```
Cmd + R         运行应用
Cmd + .         停止运行
Cmd + Shift + H 返回主屏幕
Cmd + Shift + K 显示/隐藏键盘
Cmd + 1/2/3     旋转设备
Cmd + ←/→       旋转左/右
```

#### 模拟器功能
```
Features菜单：
├─ Rotate Left/Right    旋转设备
├─ Shake Gesture        晃动设备
├─ Home                 返回主屏
└─ Lock                 锁屏
```

#### 调试菜单
```
Debug菜单：
├─ Location             模拟位置
├─ Condition Network    模拟网络状况
└─ Slow Animations      慢动作查看动画
```

---

## 💻 Mac应用调试

### 运行Mac版本

#### 第一步：切换目标
在Xcode设备选择器中选择：
```
My Mac
或
My Mac (Designed for iPad)
```

#### 第二步：运行
```
点击运行按钮或 Cmd + R
```

#### 第三步：测试
```
TIME会作为Mac原生应用运行
- 可以调整窗口大小
- 测试响应式布局
- 检查所有功能
```

### Mac调试特点

**窗口管理：**
- 可以自由调整窗口大小
- 测试不同分辨率下的显示
- 测试最小化/最大化

**性能：**
- Mac性能强劲，运行流畅
- 可以开启性能监控
- 查看内存和CPU使用

---

## 🔍 调试重点清单

### 基础功能测试

#### 计时器功能
- [ ] 点击"开始"按钮，计时器启动
- [ ] 时间正确倒计时
- [ ] 进度环动画流畅
- [ ] 点击"暂停"正常暂停
- [ ] 点击"重置"恢复初始状态
- [ ] 点击"跳过"切换到下一模式

#### 模式切换
- [ ] 点击"工作"标签，切换到工作模式
- [ ] 点击"短休息"，切换到短休息（绿色）
- [ ] 点击"长休息"，切换到长休息（橙色）
- [ ] 背景渐变颜色正确变化

### 页面导航测试

#### 统计页面
- [ ] 点击"📊 统计"进入统计页面
- [ ] 今日/本周/历史数据显示
- [ ] 底部内容不被遮挡
- [ ] "返回"按钮正常工作

#### 数据分析页面（重点测试）
- [ ] 点击"📈 分析"进入分析页面
- [ ] 看到4个数据卡片（可能为0）
- [ ] 看到5个图表位置
- [ ] 图表容器显示正常
- [ ] ECharts加载成功（查看控制台）
- [ ] 完成几个番茄后，图表有数据显示

#### 设置页面
- [ ] 点击"⚙️ 设置"进入设置页面
- [ ] 所有设置项显示正常
- [ ] 修改设置并保存
- [ ] 保存按钮在右下角
- [ ] 底部内容不被遮挡

#### 声明页面
- [ ] 点击"隐私声明"可以跳转
- [ ] 点击"开源声明"可以跳转
- [ ] 点击"广告声明"可以跳转
- [ ] 内容显示完整
- [ ] 可以正常滚动

### UI/UX测试

#### 视觉效果
- [ ] Logo显示⏰时钟图标
- [ ] 主色调是紫色渐变
- [ ] 按钮hover效果流畅
- [ ] 动画过渡自然
- [ ] 阴影效果正确

#### 响应式测试（iOS模拟器）
- [ ] iPhone SE - 小屏幕布局正确
- [ ] iPhone 15 Pro - 标准屏幕完美
- [ ] iPhone Pro Max - 大屏利用合理
- [ ] iPad - 横竖屏都正常

#### 深色模式测试
- [ ] 在设置中切换到"深色"
- [ ] 所有元素颜色正确
- [ ] 对比度良好，可读性强
- [ ] 图表在深色模式下显示正常

---

## 🔧 调试工具使用

### Xcode调试控制台

#### 查看日志
```
底部调试区域（Debug Area）：
- 显示console.log输出
- 显示错误信息
- 显示网络请求

打开/关闭：Cmd + Shift + Y
```

#### 关键日志
运行TIME后，应该看到：
```
TIME 应用已启动 ⏰
提示：可以通过 window.pomodoroApp 访问应用对象进行调试
快捷键：空格 = 开始/暂停, R = 重置, S = 跳过
```

### Safari Web Inspector（调试WebView）

#### 启用开发菜单
1. 打开模拟器中的Safari
2. Mac的Safari → 偏好设置 → 高级
3. 勾选"在菜单栏中显示开发菜单"

#### 连接到应用
1. 在Mac Safari中，点击"开发"菜单
2. 找到你的模拟器/设备
3. 选择TIME应用的WebView
4. 打开Web Inspector查看：
   - Elements（HTML结构）
   - Console（JavaScript日志）
   - Network（网络请求）
   - Resources（本地存储）

### 查看LocalStorage数据

在Web Inspector的Console中运行：
```javascript
// 查看所有存储数据
localStorage

// 查看设置
localStorage.getItem('pomodoro_settings')

// 查看统计数据
localStorage.getItem('pomodoro_statistics')

// 清空数据（测试用）
localStorage.clear()
```

---

## 🎯 重点测试项目

### 新增功能（数据分析）

#### 测试步骤
1. **运行应用**（iOS或Mac）
2. **完成3-5个番茄钟**
   - 设置工作时长为1分钟快速测试
   - 完成几个完整的番茄
   - 积累测试数据

3. **进入数据分析页面**
   - 点击"📈 分析"
   - 检查图表加载

4. **验证图表显示**
   - 📈 趋势图显示7天数据
   - 🔥 热力图显示时段分布
   - 🥧 饼图显示时间比例
   - 📊 柱状图显示对比
   - 💎 数据卡片显示统计

5. **交互测试**
   - 鼠标悬停查看详细数据
   - 图表响应窗口大小变化
   - 滚动流畅不卡顿

### 已修复问题验证

#### 布局遮挡问题
- [ ] 统计页面滚动到底，文字完全可见
- [ ] 设置页面滚动到底，按钮不被遮挡
- [ ] 数据分析页面底部图表完整显示

#### 保存按钮优化
- [ ] 桌面版：保存按钮靠右，大小适中
- [ ] 移动版：保存按钮固定右下角
- [ ] 按钮点击区域合适
- [ ] 阴影效果正确（紫色光晕）

#### 页脚链接
- [ ] 页脚显示"享受时光"
- [ ] 三个声明链接可见
- [ ] 点击链接可以跳转
- [ ] 链接hover效果正常

---

## 🐛 常见问题排查

### 问题1：应用黑屏或白屏

**检查：**
1. Xcode控制台是否有错误
2. WebView是否加载成功
3. index.html路径是否正确

**解决：**
```swift
// 检查PomodoroWebView.swift中的路径
let url = Bundle.main.url(forResource: "index", withExtension: "html", subdirectory: "Web")
```

### 问题2：图表不显示

**检查：**
1. ECharts CDN是否加载（需要网络）
2. analytics.js是否加载
3. 控制台是否有JavaScript错误

**解决：**
1. 确保模拟器有网络连接
2. 检查Web Inspector的Network标签
3. 查看ECharts请求是否成功

### 问题3：数据不保存

**检查：**
1. 是否启用了LocalStorage
2. 是否有权限问题

**解决：**
```swift
// 在PomodoroWebView.swift中确认配置
configuration.preferences.setValue(true, forKey: "allowFileAccessFromFileURLs")
```

### 问题4：通知不工作

**模拟器限制：**
- iOS模拟器不支持真实的通知
- 需要在真机上测试
- Mac版本支持通知

---

## 📱 多设备测试策略

### 第一轮：iPhone 15 Pro（标准测试）
```
1. 运行应用
2. 测试所有基础功能
3. 完成3-5个番茄钟
4. 进入数据分析页面
5. 验证所有图表
```

### 第二轮：iPhone SE（小屏测试）
```
1. 切换到iPhone SE模拟器
2. 重新运行
3. 重点测试：
   - 按钮是否过大
   - 文字是否被截断
   - 图表是否适配
   - 滚动是否流畅
```

### 第三轮：iPad Pro（平板测试）
```
1. 切换到iPad Pro
2. 测试横屏和竖屏
3. 检查空间利用
4. 验证触摸交互
```

### 第四轮：Mac（桌面测试）
```
1. 切换到"My Mac"
2. 运行Mac版本
3. 测试窗口调整
4. 检查鼠标交互
5. 验证键盘快捷键
```

---

## 🔬 详细调试流程

### iOS模拟器完整测试

#### 启动应用
```bash
# Xcode已打开
1. 选择设备：iPhone 15 Pro
2. 点击运行：Cmd + R
3. 等待启动：约30秒-1分钟
```

#### 功能测试顺序

**1. 首页测试（3分钟）**
```
✓ 检查Logo是⏰
✓ 标题显示TIME
✓ 主色调紫色
✓ 三个导航按钮
✓ 计时器显示25:00
✓ 控制按钮齐全
```

**2. 计时功能（5分钟）**
```
✓ 点击开始
✓ 观察倒计时
✓ 测试暂停
✓ 测试重置
✓ 测试跳过
✓ 模式切换
```

**3. 数据积累（5分钟）**
```
设置中将工作时长改为1分钟
完成5-6个番茄钟
目的：快速积累测试数据
```

**4. 统计页面（2分钟）**
```
✓ 点击"📊 统计"
✓ 查看今日统计
✓ 查看本周数据
✓ 滚动到底部
✓ 确认不被遮挡
```

**5. 数据分析页面（5分钟）**
```
✓ 点击"📈 分析"
✓ 查看4个数据卡片
✓ 趋势图显示数据
✓ 热力图有颜色
✓ 饼图显示比例
✓ 柱状图有对比
✓ 悬停查看详情
✓ 滚动流畅
```

**6. 设置页面（3分钟）**
```
✓ 点击"⚙️ 设置"
✓ 修改各项设置
✓ 保存按钮在右下角
✓ 点击保存
✓ 看到"设置已保存"提示
✓ 返回验证设置生效
```

**7. 声明页面（2分钟）**
```
✓ 点击"隐私声明"
✓ 内容显示完整
✓ 返回主页
✓ 点击"开源声明"
✓ 点击"广告声明"
✓ 所有链接正常
```

**8. 响应式测试（3分钟）**
```
✓ 旋转设备（Cmd + ←/→）
✓ 横屏布局正常
✓ 竖屏布局正常
✓ 切换不同设备
✓ 各尺寸适配良好
```

---

## 💻 Mac应用完整测试

### 启动Mac版
```
1. 在Xcode中选择"My Mac"
2. 点击运行 Cmd + R
3. TIME以Mac应用方式启动
```

### Mac特有测试

#### 窗口管理
```
✓ 调整窗口大小（拖动边角）
✓ 最小化窗口（Cmd + M）
✓ 全屏模式（绿色按钮）
✓ 关闭窗口（红色按钮）
✓ 重新打开应用
```

#### 菜单栏
```
✓ 应用菜单（TIME）
✓ 文件菜单
✓ 编辑菜单
✓ 窗口菜单
✓ 帮助菜单
```

#### 键盘快捷键
```
✓ 空格键：开始/暂停
✓ R键：重置
✓ S键：跳过
✓ Cmd + ,：打开设置
```

#### 系统集成
```
✓ 通知中心显示（Mac支持真实通知）
✓ Dock图标（需要设计App图标）
✓ 应用切换（Cmd + Tab）
```

---

## 📊 数据分析功能专项测试

### 准备测试数据

#### 快速生成数据
```javascript
// 在Web Inspector Console中运行
// 生成模拟数据（仅用于测试）

const testData = {
    sessions: []
};

// 生成7天的数据
for (let day = 0; day < 7; day++) {
    const date = new Date();
    date.setDate(date.getDate() - day);
    
    // 每天8-12个番茄
    const count = Math.floor(Math.random() * 5) + 8;
    
    for (let i = 0; i < count; i++) {
        const hour = Math.floor(Math.random() * 12) + 9; // 9-21点
        date.setHours(hour, 0, 0, 0);
        
        testData.sessions.push({
            type: 'work',
            duration: 25,
            timestamp: date.toISOString(),
            completed: true
        });
    }
}

// 保存测试数据
localStorage.setItem('pomodoro_statistics', JSON.stringify(testData));

// 刷新页面查看效果
location.reload();
```

### 图表验证

#### 趋势图验证
```
✓ 显示7天的折线
✓ 数据点位置正确
✓ 面积填充紫色渐变
✓ 悬停显示具体数值
✓ X轴显示日期
✓ Y轴显示番茄数
```

#### 热力图验证
```
✓ 显示24x7网格
✓ 颜色深浅表示强度
✓ 悬停显示时段和次数
✓ 渐变色从浅到深
✓ 图例显示数值范围
```

#### 饼图验证
```
✓ 显示工作和休息比例
✓ 环形设计
✓ 颜色：紫色（工作）绿色（休息）
✓ 悬停显示百分比
✓ 图例显示分类
```

#### 柱状图验证
```
✓ 显示两组柱子
✓ 灰色（上周）紫色（本周）
✓ 并排对比
✓ 悬停显示数值
✓ 图例清晰
```

#### 数据卡片验证
```
✓ 总时长显示（小时）
✓ 日均番茄数计算正确
✓ 最高记录显示
✓ 连续天数计算准确
```

---

## 🔍 性能调试

### Xcode性能工具

#### Instruments
```
Product → Profile（Cmd + I）
选择工具：
├─ Time Profiler    CPU使用分析
├─ Allocations      内存分配
├─ Leaks           内存泄漏检测
└─ Network         网络性能
```

#### Debug Navigator
```
View → Navigators → Debug（Cmd + 7）
查看实时数据：
├─ CPU使用率
├─ 内存使用
├─ 网络活动
└─ 线程情况
```

### 性能基准

**预期性能：**
```
启动时间：    < 2秒
页面切换：    < 0.3秒
图表渲染：    < 1秒
内存占用：    < 50MB
CPU使用：     < 10%（闲置时）
```

---

## 📱 真机测试（可选）

### 准备真机测试

#### 连接设备
```
1. 用数据线连接iPhone/iPad到Mac
2. 在Xcode设备列表中选择你的设备
3. 首次需要"信任此电脑"
```

#### 配置签名
```
1. 选择项目 → Signing & Capabilities
2. Team: 选择你的Apple ID
3. Bundle Identifier: 自动生成
4. 勾选"Automatically manage signing"
```

#### 运行到真机
```
1. 选择你的设备
2. 点击运行 Cmd + R
3. 首次需要在设备上信任开发者
   设置 → 通用 → VPN与设备管理 → 信任
```

### 真机测试优势
- ✅ 真实的性能表现
- ✅ 真实的通知功能
- ✅ 真实的触摸体验
- ✅ 真实的网络环境

---

## 🎯 测试检查表

### 基础功能（必测）
- [ ] 计时器正常工作
- [ ] 三种模式可切换
- [ ] 数据正确保存
- [ ] 统计数据准确

### 新功能（重点）
- [ ] 数据分析页面加载
- [ ] 5个图表显示正常
- [ ] 图表交互流畅
- [ ] 数据卡片计算正确

### UI效果（重要）
- [ ] 紫色主题正确
- [ ] Logo是时钟图标
- [ ] 动画流畅
- [ ] 响应式正常

### 多设备（全面）
- [ ] iPhone SE
- [ ] iPhone 15 Pro
- [ ] iPhone 15 Pro Max
- [ ] iPad Pro
- [ ] Mac

---

## 📝 测试报告模板

测试完成后，可以记录：

```markdown
## TIME App 调试报告

### 测试环境
- 设备：iPhone 15 Pro Simulator / My Mac
- 系统：iOS 18.0 / macOS 15.0
- Xcode：26.0.1
- 测试时间：2025年10月20日

### 测试结果

#### 通过项 ✅
- 所有基础功能正常
- 数据分析图表显示正常
- 响应式布局完美
- ...

#### 问题项 ⚠️
- 描述问题
- 复现步骤
- 截图

#### 建议 💡
- 改进建议
- 功能想法
```

---

## 🎊 调试完成后

### 确认无误后
1. ✅ 关闭Xcode（如不需要继续开发）
2. ✅ 访问在线网站测试
3. ✅ 与模拟器效果对比
4. ✅ 分享给朋友使用

### 发现问题后
1. 记录问题详情
2. 告诉我具体情况
3. 我帮你修复
4. 重新测试验证

---

## 🚀 快速启动命令

### 未来调试时使用

#### iOS模拟器
```bash
cd /Users/shanwanjun/Desktop/cxs/time/time
open time.xcodeproj
# 在Xcode中选择iOS设备并运行
```

#### Mac应用
```bash
cd /Users/shanwanjun/Desktop/cxs/time/time
open time.xcodeproj
# 在Xcode中选择My Mac并运行
```

#### Web浏览器（快速测试）
```bash
cd /Users/shanwanjun/Desktop/cxs/time
python3 -m http.server 8080
# 访问 http://localhost:8080
```

---

## 🎯 当前状态

**Xcode：** ✅ 已打开项目
**下一步：** 在Xcode中选择设备并点击运行（▶️）

**提示：**
- 首次编译可能需要1-2分钟
- 看到TIME应用界面就成功了
- 记得测试数据分析功能

---

## 📞 需要帮助？

如果遇到任何问题：
1. 截图Xcode错误信息
2. 截图应用显示情况
3. 告诉我具体问题
4. 我立即帮你解决！

---

**祝调试顺利！** 🚀

**Xcode项目已打开，现在请在Xcode中点击运行按钮开始调试！** ▶️

---

**最后更新：** 2025年10月20日
**调试环境：** Xcode 26.0.1
**测试平台：** iOS模拟器 + macOS

