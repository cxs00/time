<!DOCTYPE html>
<html lang="zh-CN">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Tracker 测试控制台</title>
    
    <!-- AdSense 配置 -->
    <meta name="google-adsense-account" content="ca-pub-6680853179152933">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6680853179152933"
         crossorigin="anonymous"></script>
    
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background: #f9f9f9;
      }

      .test-section h3 {
        margin-top: 0;
        color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
        transition: transform 0.2s;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn-danger {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
      }

      .btn-success {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .form-group textarea {
        height: 60px;
        resize: vertical;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border: 1px solid #e0e0e0;
      }

      .stat-card .number {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
      }

      .stat-card .label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      .log {
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        height: 200px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 12px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>🧪 Activity Tracker 测试控制台</h1>

      <!-- 统计信息 -->
      <div class="stats">
        <div class="stat-card">
          <div class="number" id="totalActivities">0</div>
          <div class="label">总活动数</div>
        </div>
        <div class="stat-card">
          <div class="number" id="todayActivities">0</div>
          <div class="label">今日活动</div>
        </div>
        <div class="stat-card">
          <div class="number" id="totalProjects">0</div>
          <div class="label">项目数</div>
        </div>
        <div class="stat-card">
          <div class="number" id="totalDiaries">0</div>
          <div class="label">日记数</div>
        </div>
      </div>

      <!-- 快速操作 -->
      <div class="test-section">
        <h3>🚀 快速操作</h3>
        <button class="btn" onclick="insertTestActivity()">插入随机活动</button>
        <button class="btn" onclick="insertBatchActivities(5)">批量插入5条</button>
        <button class="btn" onclick="insertBatchActivities(10)">批量插入10条</button>
        <button class="btn btn-success" onclick="reloadTestData()">重新加载测试数据</button>
        <button class="btn btn-danger" onclick="clearAllActivities()">清空所有活动</button>
      </div>

      <!-- 自定义活动插入 -->
      <div class="test-section">
        <h3>📝 自定义活动插入</h3>
        <div class="form-group">
          <label>活动内容:</label>
          <input type="text" id="activityText" placeholder="输入活动内容" value="测试活动">
        </div>
        <div class="form-group">
          <label>分类:</label>
          <select id="activityCategory">
            <option value="工作">工作</option>
            <option value="学习">学习</option>
            <option value="运动">运动</option>
            <option value="娱乐">娱乐</option>
            <option value="生活">生活</option>
          </select>
        </div>
        <div class="form-group">
          <label>持续时间(分钟):</label>
          <input type="number" id="activityDuration" value="30" min="1" max="480">
        </div>
        <div class="form-group">
          <label>效率(%):</label>
          <input type="number" id="activityEfficiency" value="85" min="0" max="100">
        </div>
        <div class="form-group">
          <label>心情:</label>
          <select id="activityMood">
            <option value="productive">productive</option>
            <option value="happy">happy</option>
            <option value="focused">focused</option>
            <option value="relaxed">relaxed</option>
            <option value="tired">tired</option>
          </select>
        </div>
        <div class="form-group">
          <label>标签(用逗号分隔):</label>
          <input type="text" id="activityTags" placeholder="标签1,标签2" value="测试,开发">
        </div>
        <button class="btn" onclick="insertCustomActivity()">插入自定义活动</button>
      </div>

      <!-- 数据管理 -->
      <div class="test-section">
        <h3>💾 数据管理</h3>
        <button class="btn" onclick="exportActivities()">导出活动数据</button>
        <button class="btn" onclick="document.getElementById('importFile').click()">导入活动数据</button>
        <input type="file" id="importFile" accept=".json" style="display: none;"
          onchange="importActivities(this.files[0])">
        <button class="btn" onclick="showDataStats()">显示数据统计</button>
      </div>

      <!-- 测试日志 -->
      <div class="test-section">
        <h3>📋 测试日志</h3>
        <div class="log" id="testLog"></div>
        <button class="btn" onclick="clearLog()">清空日志</button>
      </div>
    </div>

    <script>
      // 日志功能
      function log(message) {
        const logElement = document.getElementById('testLog');
        const timestamp = new Date().toLocaleTimeString();
        logElement.innerHTML += `[${timestamp}] ${message}\n`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      function clearLog() {
        document.getElementById('testLog').innerHTML = '';
      }

      // 更新统计信息
      function updateStats() {
        const activities = JSON.parse(localStorage.getItem('activityTracker_activities') || '[]');
        const projects = JSON.parse(localStorage.getItem('activityTracker_projects') || '[]');
        const diaries = JSON.parse(localStorage.getItem('activityTracker_diary') || '[]');

        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const todayActivities = activities.filter(activity => {
          const activityDate = new Date(activity.startTime);
          activityDate.setHours(0, 0, 0, 0);
          return activityDate.getTime() === today.getTime();
        });

        document.getElementById('totalActivities').textContent = activities.length;
        document.getElementById('todayActivities').textContent = todayActivities.length;
        document.getElementById('totalProjects').textContent = projects.length;
        document.getElementById('totalDiaries').textContent = diaries.length;
      }

      // 插入自定义活动
      function insertCustomActivity() {
        const activityData = {
          text: document.getElementById('activityText').value,
          category: document.getElementById('activityCategory').value,
          duration: parseInt(document.getElementById('activityDuration').value),
          efficiency: parseInt(document.getElementById('activityEfficiency').value),
          mood: document.getElementById('activityMood').value,
          tags: document.getElementById('activityTags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
        };

        const result = insertActivityRecord(activityData);
        log(`✅ 插入自定义活动: ${result.text}`);
        updateStats();
      }

      // 显示数据统计
      function showDataStats() {
        const activities = JSON.parse(localStorage.getItem('activityTracker_activities') || '[]');
        const categoryStats = {};

        activities.forEach(activity => {
          categoryStats[activity.category] = (categoryStats[activity.category] || 0) + 1;
        });

        let statsText = '📊 数据统计:\n';
        statsText += `总活动数: ${activities.length}\n`;
        statsText += '分类统计:\n';
        Object.entries(categoryStats).forEach(([category, count]) => {
          statsText += `  ${category}: ${count} 条\n`;
        });

        log(statsText);
      }

      // 重写全局函数以添加日志
      const originalInsertActivityRecord = window.insertActivityRecord;
      window.insertActivityRecord = function (activityData) {
        const result = originalInsertActivityRecord(activityData);
        log(`📝 插入活动: ${result.text} (${result.category})`);
        updateStats();
        return result;
      };

      const originalInsertTestActivity = window.insertTestActivity;
      window.insertTestActivity = function () {
        const result = originalInsertTestActivity();
        log(`🎲 插入随机活动: ${result.text} (${result.category})`);
        updateStats();
        return result;
      };

      const originalInsertBatchActivities = window.insertBatchActivities;
      window.insertBatchActivities = function (count) {
        const result = originalInsertBatchActivities(count);
        log(`📦 批量插入 ${count} 条活动记录`);
        updateStats();
        return result;
      };

      const originalClearAllActivities = window.clearAllActivities;
      window.clearAllActivities = function () {
        const result = originalClearAllActivities();
        if (result) {
          log('🗑️ 清空所有活动记录');
          updateStats();
        }
        return result;
      };

      const originalReloadTestData = window.reloadTestData;
      window.reloadTestData = function () {
        originalReloadTestData();
        log('🔄 重新加载测试数据');
        updateStats();
      };

      // 初始化
      document.addEventListener('DOMContentLoaded', function () {
        log('🚀 测试控制台已启动');
        updateStats();
      });
    </script>
  </body>

</html>
