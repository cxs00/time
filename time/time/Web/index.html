<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Activity Tracker - æ™ºèƒ½æ´»åŠ¨è®°å½•ä¸è¿›åº¦ç®¡ç†">
    <title>Activity Tracker v3.9.0 - æ™ºèƒ½æ´»åŠ¨è®°å½•</title>

    <!-- Google AdSense ç½‘ç«™æ‰€æœ‰æƒéªŒè¯ -->
    <meta name="google-adsense-account" content="ca-pub-6680853179152933">

    <!-- Google AdSense ä»£ç æ®µéªŒè¯ -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6680853179152933"
      crossorigin="anonymous"></script>

    <!-- PWAé…ç½® -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Activity Tracker">

    <!-- å®‰å…¨å¤´éƒ¨ -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- å†…è”å…³é”®CSSç¡®ä¿æ ·å¼ç”Ÿæ•ˆ -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #f8f9fa;
        /* iOSå®‰å…¨åŒºåŸŸæ”¯æŒ */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }

      /* å¯¼èˆªæ  */
      .navbar {
        background: #ffffff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 1rem;
        /* iOSå®‰å…¨åŒºåŸŸé¡¶éƒ¨æ”¯æŒ */
        padding-top: max(1rem, env(safe-area-inset-top));
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 1rem;
      }

      .brand-icon {
        font-size: 1.5rem;
      }

      .brand-name {
        color: #667eea;
      }

      .nav-links {
        display: flex;
        justify-content: space-around;
        width: 100%;
        gap: 0.5rem;
      }

      .nav-link {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        padding: 0.5rem 0.25rem;
        text-decoration: none;
        color: #666;
        border-radius: 8px;
        flex: 1;
        max-width: 70px;
      }

      .nav-link.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .nav-icon {
        font-size: 1.5rem;
      }

      .nav-text {
        font-size: 0.7rem;
        white-space: nowrap;
      }

      /* é¡µé¢åˆ‡æ¢ */
      .page {
        display: none;
        padding: 1rem;
      }

      .page.active {
        display: block;
      }

      /* å®¹å™¨åº•éƒ¨è¾¹è· - ä¸ºå¹¿å‘Šé¢„ç•™ç©ºé—´ */
      .container {
        padding-bottom: 85px !important;
        /* 70pxå¹¿å‘Š + 15pxç¼“å†² */
      }

      /* å¡ç‰‡ */
      .card {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .card-title {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      /* ==================== æ¨¡æ€æ¡†æ ·å¼ï¼ˆå†…è”ç¡®ä¿ç”Ÿæ•ˆï¼‰ ==================== */
      .modal {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        background: rgba(0, 0, 0, 0.5) !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        z-index: 10001 !important;
        /* é«˜äºè°ƒè¯•é¢æ¿(10000) */
        animation: modalFadeIn 0.3s ease;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      .modal-content {
        background: white !important;
        border-radius: 16px !important;
        padding: 2rem !important;
        max-width: 500px !important;
        width: 90% !important;
        max-height: 80vh !important;
        overflow-y: auto !important;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2) !important;
        animation: modalSlideUp 0.3s ease;
        position: relative !important;
        z-index: 10002 !important;
      }

      @keyframes modalSlideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-content h3 {
        margin: 0 0 1.5rem 0 !important;
        color: #333 !important;
        font-size: 1.5rem !important;
        background: linear-gradient(135deg, #667eea, #764ba2) !important;
        -webkit-background-clip: text !important;
        -webkit-text-fill-color: transparent !important;
        background-clip: text !important;
      }

      .form-group {
        margin-bottom: 1.5rem !important;
      }

      .form-group label {
        display: block !important;
        margin-bottom: 0.5rem !important;
        color: #555 !important;
        font-weight: 600 !important;
        font-size: 0.9rem !important;
      }

      .form-group input[type="text"],
      .form-group input[type="date"],
      .form-group select,
      .form-group textarea {
        width: 100% !important;
        padding: 0.75rem !important;
        border: 2px solid #e0e0e0 !important;
        border-radius: 8px !important;
        font-size: 1rem !important;
        transition: all 0.3s !important;
        font-family: inherit !important;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none !important;
        border-color: #667eea !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
      }

      .form-group textarea {
        min-height: 100px !important;
        resize: vertical !important;
      }

      .form-group input[type="range"] {
        width: calc(100% - 60px) !important;
        margin-right: 10px !important;
      }

      .form-actions {
        display: flex !important;
        gap: 1rem !important;
        justify-content: flex-end !important;
        margin-top: 2rem !important;
      }

      .form-actions button {
        padding: 0.75rem 1.5rem !important;
        border: none !important;
        border-radius: 8px !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        transition: all 0.3s !important;
      }

      .btn-primary,
      .form-actions button[type="submit"] {
        background: linear-gradient(135deg, #667eea, #764ba2) !important;
        color: white !important;
      }

      .btn-secondary,
      .form-actions button[type="button"] {
        background: #f0f0f0 !important;
        color: #666 !important;
      }

      /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
      @media (max-width: 768px) {
        .modal-content {
          width: 95% !important;
          padding: 1.5rem !important;
          max-height: 90vh !important;
        }

        .modal-content h3 {
          font-size: 1.25rem !important;
        }

        .form-actions {
          flex-direction: column !important;
        }

        .form-actions button {
          width: 100% !important;
        }
      }
    </style>

    <link rel="stylesheet" href="css/activity-tracker.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
</head>

<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
      <div class="nav-brand">
        <span class="brand-icon">ğŸ“Š</span>
        <span class="brand-name">Activity Tracker</span>
      </div>
      <div class="nav-links">
        <a href="#home" class="nav-link active" data-page="home">
          <span class="nav-icon">ğŸ </span>
          <span class="nav-text">è®°å½•</span>
        </a>
        <a href="#projects" class="nav-link" data-page="projects">
          <span class="nav-icon">ğŸ¯</span>
          <span class="nav-text">é¡¹ç›®</span>
        </a>
        <a href="#stats" class="nav-link" data-page="stats">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-text">ç»Ÿè®¡</span>
        </a>
        <a href="#diary" class="nav-link" data-page="diary">
          <span class="nav-icon">ğŸ“–</span>
          <span class="nav-text">æ—¥è®°</span>
        </a>
        <a href="#settings" class="nav-link" data-page="settings">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-text">è®¾ç½®</span>
        </a>
      </div>
    </nav>

    <!-- ä¸»é¡µé¢ - æ´»åŠ¨è®°å½• -->
    <main id="home" class="page active">
    <div class="container">
        <!-- å½“å‰æ´»åŠ¨çŠ¶æ€ -->
        <section class="current-activity-card card">
          <h3 class="card-title">ğŸ“Š å½“å‰æ´»åŠ¨</h3>
          <div id="currentActivity" class="activity-display">
            <div class="activity-info">
              <span class="activity-name">æš‚æ— æ´»åŠ¨</span>
              <span class="activity-duration">00:00:00</span>
            </div>
            <div class="activity-controls">
              <button id="pauseActivity" class="btn btn-pause" disabled>â¸ï¸ æš‚åœ</button>
              <button id="endActivity" class="btn btn-end" disabled>â¹ï¸ ç»“æŸ</button>
            </div>
          </div>
        </section>

        <!-- å¿«é€Ÿè®°å½• -->
        <section class="quick-record-card card">
          <div class="card-header-with-action">
            <h3 class="card-title">âš¡ å¿«é€Ÿè®°å½•</h3>
            <button class="btn btn-secondary btn-sm" onclick="window.smartActivityTracker.addManualActivity()">â•
              æ‰‹åŠ¨æ·»åŠ æ´»åŠ¨</button>
                </div>
          <div class="record-form">
            <div class="input-group">
              <input type="text" id="activityInput" placeholder="ç°åœ¨åœ¨åšä»€ä¹ˆï¼Ÿ" class="activity-input">
              <div class="smart-suggestions" id="smartSuggestions"></div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>åˆ†ç±»ï¼š</label>
                <select id="categorySelect" class="select-input">
                  <option value="">æ™ºèƒ½æ¨è</option>
                  <option value="å·¥ä½œ">ğŸ’¼ å·¥ä½œ</option>
                  <option value="å­¦ä¹ ">ğŸ“š å­¦ä¹ </option>
                  <option value="è¿åŠ¨">ğŸƒ è¿åŠ¨</option>
                  <option value="å¨±ä¹">ğŸ® å¨±ä¹</option>
                  <option value="ç”Ÿæ´»">ğŸ  ç”Ÿæ´»</option>
                </select>
                <button id="addCustomCategory" class="btn btn-secondary">+ è‡ªå®šä¹‰</button>
            </div>

              <div class="form-group">
                <label>å…³è”é¡¹ç›®ï¼š</label>
                <select id="projectSelect" class="select-input">
                  <option value="">è‡ªåŠ¨å…³è”</option>
                </select>
                </div>
            </div>

            <button id="startActivity" class="btn btn-primary btn-start">ğŸš€ å¼€å§‹è®°å½•</button>
            </div>
        </section>

        <!-- ä»Šæ—¥æ¦‚è§ˆ -->
        <section class="today-overview-card card">
          <h3 class="card-title">ğŸ“ˆ ä»Šæ—¥æ¦‚è§ˆ</h3>
          <div class="activity-summary">
            <div class="summary-stats">
                        <div class="stat-item">
                <span class="stat-label">æ€»æ—¶é—´</span>
                <span class="stat-value" id="totalTime">0å°æ—¶</span>
                        </div>
                        <div class="stat-item">
                <span class="stat-label">æ´»åŠ¨æ•°</span>
                <span class="stat-value" id="activityCount">0</span>
                        </div>
                        <div class="stat-item">
                <span class="stat-label">æ•ˆç‡</span>
                <span class="stat-value" id="efficiency">0%</span>
                        </div>
            </div>
            <!-- ä»Šæ—¥æ´»åŠ¨åˆ†å¸ƒé¥¼å›¾ -->
            <div class="activity-distribution">
              <h4 class="distribution-title">ğŸ“Š ä»Šæ—¥æ´»åŠ¨åˆ†å¸ƒ</h4>
              <div class="chart-container-small">
                <div id="todayDistributionChart" style="width: 100%; height: 200px;"></div>
                    </div>
                </div>
            <div class="activity-timeline" id="activityTimeline"></div>
                    </div>
        </section>
                        </div>
    </main>

    <!-- é¡¹ç›®é¡µé¢ -->
    <main id="projects" class="page">
      <div class="container">
        <div class="page-header">
          <h2>ğŸ¯ é¡¹ç›®è¿›åº¦</h2>
          <button id="createProject" class="btn btn-primary">+ æ–°å»ºé¡¹ç›®</button>
                        </div>
        <div class="projects-grid" id="projectsGrid">
          <p class="no-projects">è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•é¡¹ç›®</p>
                    </div>
                </div>
    </main>

    <!-- ç»Ÿè®¡é¡µé¢ -->
    <main id="stats" class="page">
      <div class="container">
        <section class="time-selector-card card">
          <h3 class="card-title">ğŸ“Š æ´»åŠ¨ç»Ÿè®¡</h3>
          <div class="time-range-selector">
            <select id="timeRange" class="select-input">
              <option value="today">ä»Šå¤©</option>
              <option value="week">æœ¬å‘¨</option>
              <option value="month">æœ¬æœˆ</option>
              <option value="quarter">æœ¬å­£åº¦</option>
              <option value="year">ä»Šå¹´</option>
              <option value="custom">è‡ªå®šä¹‰</option>
            </select>
            <input type="date" id="startDate" class="date-input" style="display:none;">
            <input type="date" id="endDate" class="date-input" style="display:none;">
            <button id="applyTimeRange" class="btn btn-primary" style="display:none;">åº”ç”¨</button>
                        </div>
        </section>

        <div class="charts-container">
          <section class="chart-card card">
            <h3 class="card-title">ğŸ“Š æ´»åŠ¨æ—¶é—´åˆ†å¸ƒ</h3>
            <div id="activityPieChart" class="chart"></div>
          </section>

          <section class="chart-card card">
            <h3 class="card-title">ğŸ“ˆ æ—¶é—´è¶‹åŠ¿</h3>
            <div id="trendLineChart" class="chart"></div>
          </section>

          <section class="chart-card card">
            <h3 class="card-title">ğŸ”¥ æ´»åŠ¨çƒ­åŠ›å›¾</h3>
            <div id="activityHeatmap" class="chart"></div>
          </section>
                        </div>
                    </div>
    </main>

    <!-- æ—¥è®°é¡µé¢ -->
    <main id="diary" class="page">
      <div class="container">
        <div class="diary-memo-grid">
          <!-- æ—¥è®°åŠŸèƒ½ -->
          <section class="diary-card card">
            <h3 class="card-title">ğŸ“– ä»Šæ—¥æ—¥è®°</h3>
            <div class="diary-editor">
              <div class="diary-header">
                <span class="diary-date" id="diaryDate"></span>
                <div class="mood-selector">
                  <label>å¿ƒæƒ…ï¼š</label>
                  <select id="moodSelect" class="select-input">
                    <option value="ğŸ˜Š">ğŸ˜Š å¼€å¿ƒ</option>
                    <option value="ğŸ˜">ğŸ˜ å¹³é™</option>
                    <option value="ğŸ˜”">ğŸ˜” ä½è½</option>
                    <option value="ğŸ˜¤">ğŸ˜¤ æ„¤æ€’</option>
                    <option value="ğŸ˜´">ğŸ˜´ ç–²æƒ«</option>
                  </select>
                </div>
                    </div>
              <input type="text" id="diaryTitle" class="diary-title-input" placeholder="ç»™ä»Šå¤©çš„æ—¥è®°èµ·ä¸ªæ ‡é¢˜...">
              <textarea id="diaryContent" class="diary-textarea" placeholder="è®°å½•ä»Šå¤©çš„å¿ƒæƒ…å’Œæƒ³æ³•..."></textarea>
              <div class="diary-actions">
                <button id="saveDiary" class="btn btn-primary">ğŸ’¾ ä¿å­˜</button>
                <button id="aiSuggest" class="btn btn-secondary">ğŸ¤– AIå»ºè®®</button>
                </div>
            </div>
        </section>

          <!-- å†å²æ—¥è®°åˆ—è¡¨ -->
          <section class="diary-history-card card">
            <h3 class="card-title">ğŸ“š å†å²æ—¥è®°</h3>
            <div class="diary-list" id="diaryList">
              <p class="no-diaries">è¿˜æ²¡æœ‰å†™ä»»ä½•æ—¥è®°</p>
            </div>
          </section>

          <!-- å¤‡å¿˜å½•åŠŸèƒ½ -->
          <section class="memo-card card">
            <h3 class="card-title">ğŸ“Œ å¤‡å¿˜å½•</h3>
            <div class="memo-input-group">
              <input type="text" id="memoInput" class="memo-input" placeholder="è®°å½•æƒ³æ³•æˆ–æé†’...">
              <button id="addMemo" class="btn btn-primary">+</button>
                    </div>
            <div class="memo-list" id="memoList">
              <p class="no-memos">è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å¤‡å¿˜å½•</p>
                    </div>
          </section>
                    </div>
                </div>
    </main>


    <!-- è®¾ç½®é¡µé¢ -->
    <main id="settings" class="page">
      <div class="container">
        <section class="settings-card card">
          <h3 class="card-title">âš™ï¸ è®¾ç½®</h3>
          <div class="settings-content">
            <!-- ä¸»é¢˜è®¾ç½® -->
            <div class="setting-item">
              <label>ğŸ¨ ç•Œé¢ä¸»é¢˜</label>
              <select id="themeSelect" class="select-input"
                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #e0e0e0;">
                <option value="default">é»˜è®¤ä¸»é¢˜</option>
                <option value="starry-night">âœ¨ æ˜Ÿå¤œ</option>
                <option value="water-lilies">ğŸ’§ ç¡è²</option>
              </select>
                </div>

            <!-- UIå°ºå¯¸è®¾ç½® -->
                    <div class="setting-item">
              <label>ğŸ“ UIå°ºå¯¸</label>
              <select id="sizeSelect" class="select-input"
                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #e0e0e0;">
                <option value="standard">æ ‡å‡†</option>
                <option value="large">å¤§</option>
                <option value="extra-large">è¶…å¤§</option>
                        </select>
                    </div>

            <!-- å¹¿å‘Šè®¾ç½® -->
            <div class="setting-item">
              <label>ğŸ“¢ æ˜¾ç¤ºå¹¿å‘Šï¼ˆæ”¯æŒå¼€å‘ï¼‰</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <label class="switch" style="position: relative; display: inline-block; width: 60px; height: 34px;">
                  <input type="checkbox" id="adsEnabledToggle" checked style="opacity: 0; width: 0; height: 0;">
                  <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
                               background-color: #ccc; transition: .4s; border-radius: 34px;"></span>
                  <span style="position: absolute; content: ''; height: 26px; width: 26px; left: 4px; bottom: 4px;
                               background-color: white; transition: .4s; border-radius: 50%;"></span>
                </label>
                <span id="adsStatusText" style="color: #28a745; font-weight: 600;">å·²å¯ç”¨</span>
              </div>
              <small style="color: #6c757d; display: block; margin-top: 0.5rem;">
                å¹¿å‘Šæ”¶å…¥ç”¨äºæ”¯æŒé¡¹ç›®ç»´æŠ¤å’ŒåŠŸèƒ½å¼€å‘
              </small>
                </div>

            <hr style="margin: 20px 0; border: none; border-top: 1px solid #e0e0e0;">

                    <div class="setting-item">
              <label>æ•°æ®å¯¼å‡º</label>
              <button class="btn btn-secondary" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                    </div>
            <div class="setting-item">
              <label>æ•°æ®å¯¼å…¥</label>
              <button class="btn btn-secondary" onclick="importData()">å¯¼å…¥æ•°æ®</button>
                </div>
            <div class="setting-item">
              <label>åˆ é™¤æ‰€æœ‰é¡¹ç›®</label>
              <button class="btn btn-warning" onclick="deleteAllProjects()" 
                      style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰é¡¹ç›®
              </button>
              <small style="color: #6c757d; display: block; margin-top: 0.5rem;">
                å°†åˆ é™¤æ‰€æœ‰é¡¹ç›®æ•°æ®ï¼ˆä¸å½±å“æ´»åŠ¨è®°å½•ï¼‰
              </small>
            </div>
            <div class="setting-item">
              <label>åˆ é™¤æ‰€æœ‰æ—¥è®°</label>
              <button class="btn btn-warning" onclick="deleteAllDiaries()" 
                      style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                ğŸ“– åˆ é™¤æ‰€æœ‰æ—¥è®°
              </button>
              <small style="color: #6c757d; display: block; margin-top: 0.5rem;">
                å°†åˆ é™¤æ‰€æœ‰æ—¥è®°æ¡ç›®ï¼ˆä¸å½±å“å…¶ä»–æ•°æ®ï¼‰
              </small>
            </div>
            <div class="setting-item">
              <label>æ¸…é™¤æ‰€æœ‰æ•°æ®</label>
              <button class="btn btn-danger" onclick="clearAllData()">æ¸…é™¤æ•°æ®</button>
            </div>
            </div>
        </section>
    </div>
    </main>

    <!-- Toasté€šçŸ¥ -->
    <div class="toast" id="toast">
        <span class="toast-icon">âœ“</span>
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- JavaScript -->

    <script src="js/storage.js"></script>
    <script src="js/notification.js"></script>
    <script src="js/ai-classifier.js"></script>
    <script src="js/activity-tracker.js"></script>
    <script src="js/project-manager.js"></script>
    <script src="js/diary-memo.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/advanced-charts.js"></script>
    <script src="js/app-main.js"></script>

    <!-- ä¸»é¢˜å’ŒUIå°ºå¯¸åˆ‡æ¢ -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const themeSelect = document.getElementById('themeSelect');
        const sizeSelect = document.getElementById('sizeSelect');

        // åŠ è½½ä¿å­˜çš„è®¾ç½®
        const savedTheme = localStorage.getItem('app-theme') || 'default';
        const savedSize = localStorage.getItem('app-size') || 'standard';

        if (themeSelect) {
          themeSelect.value = savedTheme;
          applyTheme(savedTheme);

          themeSelect.addEventListener('change', function () {
            const theme = this.value;
            applyTheme(theme);
            localStorage.setItem('app-theme', theme);
            showToast('ä¸»é¢˜å·²åˆ‡æ¢');
          });
        }

        if (sizeSelect) {
          sizeSelect.value = savedSize;
          applySize(savedSize);

          sizeSelect.addEventListener('change', function () {
            const size = this.value;
            applySize(size);
            localStorage.setItem('app-size', size);
            showToast('UIå°ºå¯¸å·²æ›´æ”¹');
          });
        }

        // å¹¿å‘Šå¼€å…³è®¾ç½®
        const adsEnabledToggle = document.getElementById('adsEnabledToggle');
        const adsStatusText = document.getElementById('adsStatusText');

        if (adsEnabledToggle && window.adSenseManager) {
          // åŠ è½½ä¿å­˜çš„è®¾ç½®
          const settings = window.adSenseManager.getSettings();
          const adsEnabled = settings.adsEnabled !== false;

          adsEnabledToggle.checked = adsEnabled;
          adsStatusText.textContent = adsEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
          adsStatusText.style.color = adsEnabled ? '#28a745' : '#6c757d';

          // ç›‘å¬å¼€å…³å˜åŒ–
          adsEnabledToggle.addEventListener('change', function () {
            const enabled = this.checked;
            if (window.adSenseManager) {
              window.adSenseManager.setAdsEnabled(enabled);
              adsStatusText.textContent = enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
              adsStatusText.style.color = enabled ? '#28a745' : '#6c757d';
              showToast(enabled ? 'å¹¿å‘Šå·²å¯ç”¨' : 'å¹¿å‘Šå·²ç¦ç”¨');
            }
          });
        }

        // ç›‘å¬DOMå˜åŒ–ï¼Œç¡®ä¿åç»­åŠ¨æ€æ¸²æŸ“çš„å…ƒç´ ä¹Ÿåº”ç”¨å°ºå¯¸è®¾ç½®
        const mo = new MutationObserver(() => {
          try {
            const currentSize = localStorage.getItem('app-size') || 'standard';
            applySize(currentSize);
          } catch (e) {
            console.warn('MutationObserver applySize error:', e);
          }
        });
        mo.observe(document.body, { childList: true, subtree: true });
      });

      function applyTheme(theme) {
        document.body.className = document.body.className.replace(/theme-\S+/g, '');
        if (theme !== 'default') {
          document.body.classList.add('theme-' + theme);
        }

        if (theme === 'starry-night') {
          document.body.style.background = 'linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%)';
        } else if (theme === 'water-lilies') {
          document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        } else {
          document.body.style.background = '';
        }
      }

      function applySize(size) {
        const sizes = {
          'standard': { input: '48px', button: '48px', font: '16px', padding: '14px 18px', buttonPadding: '14px 26px' },
          'large': { input: '54px', button: '54px', font: '17px', padding: '16px 20px', buttonPadding: '16px 28px' },
          'extra-large': { input: '60px', button: '60px', font: '18px', padding: '18px 22px', buttonPadding: '18px 32px' }
        };

        const config = sizes[size] || sizes.standard;

        // ç›´æ¥åº”ç”¨åˆ°æ‰€æœ‰è¾“å…¥æ¡†å’ŒæŒ‰é’®
        const inputs = document.querySelectorAll('.activity-input, input[type="text"], textarea, select');
        inputs.forEach(el => {
          el.style.minHeight = config.input;
          el.style.fontSize = config.font;
          el.style.padding = config.padding;
        });

        const buttons = document.querySelectorAll('.btn, button');
        buttons.forEach(el => {
          el.style.minHeight = config.button;
          el.style.fontSize = config.font;
          el.style.padding = config.buttonPadding;
          el.style.borderRadius = '10px';
        });
      }

      // æš´éœ²åˆ°windowï¼Œä¾¿äºå…¶ä»–æ¨¡å—åœ¨æ¸²æŸ“åä¸»åŠ¨è°ƒç”¨
      window.applySize = applySize;
      window.applyTheme = applyTheme;
    </script>

    <!-- PWAæ³¨å†Œè„šæœ¬ -->
    <script src="js/pwa-register.js"></script>

    <!-- AdSenseå¹¿å‘Šè„šæœ¬ -->
    <script src="js/adsense.js"></script>
</body>

  <!-- åº•éƒ¨å›ºå®šæ¨ªå¹…å¹¿å‘Šå®¹å™¨ï¼ˆå›ºå®š70pxé«˜åº¦ - å¢åŠ ä¸‰åˆ†ä¹‹ä¸€ï¼‰-->
  <div id="fixed-banner-ad-container" class="fixed-banner-ad" style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 999;
              height: 70px; min-height: 70px; max-height: 70px; overflow: hidden;
              background: #f0f0f0;
              display: flex; align-items: center; justify-content: center;">
    <span style="color: #666; font-size: 12px;">å¹¿å‘ŠåŠ è½½ä¸­...</span>
  </div>

  <!-- å¹¿å‘Šè‡ªé€‚åº”è„šæœ¬ï¼ˆç®€åŒ–ç‰ˆ - å›ºå®šé«˜åº¦ï¼‰-->
  <script>
    (function () {
      function adjustAdHeight() {
        const adContainer = document.getElementById('fixed-banner-ad-container');
        if (!adContainer) return;

        // ğŸ”§ å›ºå®šé«˜åº¦æ–¹æ¡ˆï¼š70pxï¼ˆå¢åŠ ä¸‰åˆ†ä¹‹ä¸€ä»¥å®Œæ•´æ˜¾ç¤ºå¹¿å‘Šå†…å®¹ï¼‰
        const adHeight = 70;

        // å¼ºåˆ¶åº”ç”¨æ ·å¼
        adContainer.style.height = adHeight + 'px';
        adContainer.style.minHeight = adHeight + 'px';
        adContainer.style.maxHeight = adHeight + 'px';
        adContainer.style.overflow = 'hidden'; // é˜²æ­¢å†…å®¹æº¢å‡º

        // è°ƒæ•´ä¸»å†…å®¹åŒºåŸŸçš„åº•éƒ¨padding
        const mainContent = document.querySelector('.container');
        if (mainContent) {
          mainContent.style.paddingBottom = (adHeight + 15) + 'px';
        }

        console.log('ğŸ“ å¹¿å‘Šé«˜åº¦å·²è®¾ç½®ä¸ºå›ºå®šå€¼:', adHeight + 'px');
      }

      // ç¡®ä¿ DOM åŠ è½½åæ‰§è¡Œ
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', adjustAdHeight);
      } else {
        adjustAdHeight();
      }

      // ç›‘å¬çª—å£å˜åŒ–ï¼ˆç¡®ä¿æ¨ªç«–å±åˆ‡æ¢æ—¶ä¹Ÿä¿æŒå›ºå®šé«˜åº¦ï¼‰
      window.addEventListener('resize', adjustAdHeight);
    })();
  </script>

</html>
